	<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


		<title>Concourse CI - DevFest Karlsruhe 2019</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/solarized.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<style type="text/css">
		    #header-left {
		        position: absolute;
		        top: 0%;
		        left: 0%;
		    }
		    #header-right {
		        position: absolute;
		        top: 0%;
		        right: 0%;
		    }
		    #footer-left {
		        position: absolute;
		        bottom: 0%;
		        left: 0%;
		        margin-left: 10px;
		        margin-bottom: 10px;
		    }
		</style>

	</head>
	<body>
		<div id="hidden" style="display:none;">
		    <div id="header">
		        <div id="footer-left"><!--<a href="https://twitter.com/muehsi">@muehsi</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://twitter.com/kaktusmimi">@kaktusmimi</a>--></div>
		    </div>
		</div>
		<div class="reveal">
			<div class="slides">
<section>
<h1>Concourse CI</h1>

<h2>DevFest Karlsruhe 2019</h2>
<img src="images/complex-failed-pipeline.png" style="border: 0; box-shadow: none;" />
</section>

<section data-markdown>
<script type="text/template">
# Michael Lihs
# <a href="https://twitter.com/kaktusmimi">@kaktusmimi</a>
</script>
</section>

<section data-markdown>
<script type="text/template">
## Agenda
<ul style="list-style: none">
	<li><strong style="font-size: 150%">ü•ú</strong>&nbsp;&nbsp; <a href="#nutshell">CI/CD in a Nutshell</a></li>
<li><strong style="font-size: 150%">‚úÖ</strong>&nbsp;&nbsp; <a href="#expectations">CI/CD Server Expectations</a></li>
<li><strong style="font-size: 150%">üîß</strong>&nbsp;&nbsp; <a href="#setup">How to setup Concourse</a></li>
<li><strong style="font-size: 150%">üìê</strong>&nbsp;&nbsp; <a href="#architecture">Concourse Architecture</a></li>
<li><strong style="font-size: 150%">üèó</strong>&nbsp;&nbsp; <a href="#blocks">Concourse Building Blocks</a></li>
<li><strong style="font-size: 150%">üñ•</strong>&nbsp;&nbsp; <a href="#demo">Demo</a></li>
	<li><strong style="font-size: 150%">‚ôªÔ∏è</strong>&nbsp;&nbsp; <a href="#recap">Recap</a></li>
</ul>
</script>
</section>

<section data-markdown id="nutshell">
<script type="text/template">
<h1 style="font-size: 600%">CI/CD in a Nutshell ü•ú</h1>
</script>
</section>

<section data-markdown>
<script type="text/template">
# Four Key Metrics

## 1. lead time
## 2. deployment frequency
## 3. mean time to restore
## 4. change fail percentage

see <a href="https://www.thoughtworks.com/de/radar/techniques/four-key-metrics">ThoughtWorks Technology Radar - Four Key Metrics</a>
</script>
</section>

<section data-markdown>
<script type="text/template">
# Main Tasks of CI/CD

* make building and delivering software more <strong style="font-size: 150%">reliable</strong>
* <strong style="font-size: 150%">automate</strong> things that (used to) hurt
* support working in <strong style="font-size: 150%">small batches</strong>
* let developers focus on features / <strong style="font-size: 150%">value</strong>
* establish <strong style="font-size: 150%">feedback loops</strong>
* help developer to <strong style="font-size: 150%">improve the 4 key metrics</strong>
</script>
</section>

<section data-markdown id="expectations">
<script type="text/template">
<h1 style="font-size: 500%">‚úÖ CI/CD Server Expectations</h1>
</script>
</section>

<section data-markdown id="expectations">
<script type="text/template">
## CI/CD Server Expectations 1

* CI/CD infrastructure is often operated by devs
* easy setup and day 2 operations
  * run it in containers
  * updates, plugins...
* integration in company infrastructure
  * IAM, Version Control, logging, monitoring
* configuration as code
* scalability (build agents)
</script>
</section>

<section data-markdown>
<script type="text/template">
## CI/CD Server Expectations 2

* pipelines as first-class-citizens
  * proper visualization
  * more complex pipelines, a.k.a. fan-in and fan-out
* pipelines as code
  * declarative description
  * no UI needed for configuration
  * kept in version control, close to the app
</script>
</section>

<section data-markdown>
<script type="text/template">
## CI/CD Server Expectations 3

* customizable build environment
  * reliable
  * containerized builds
  * easy cleanup
* develop and debug pipelines on local machines
  * locally executable
  * easy to debug
</script>
</section>

<section data-markdown>
<script type="text/template">
<h1 style="font-size: 600%">Pipelines that don't suck</h1>

### üîó [Build pipelines that don't suck](https://github.com/sirech/talks/blob/master/2019-04-tw-build_pipelines.pdf) üëçüëçüëç
</script>
</section>

<section data-markdown id="setup">
<script type="text/template">
<h1 style="font-size: 600%">Concourse Setup üîß</h1>
</script>
</section>

				<section data-markdown>
					<script type="text/template">
						## Docker Compose

						* official Docker Compose setup

						    ```
						    $ wget https://concourse-ci.org/docker-compose.yml
						    $ docker-compose up -d
						    ```

						* further services (Vault, RocketChat...) can be added
						* more elaborate `docker-compose.yml`: https://github.com/michaellihs/concourse-demo/blob/master/docker-compose.yml

					</script>
				</section>

                <section data-markdown>
                    <script type="text/template">
						## Cloud Installer
						
						* *CI-First-Approach*:
						  1. First spin-up CI infrastructure
						  2. Deploy everything else using pipelines

						* <a href="https://github.com/EngineerBetter/control-tower ">Control Tower</a> (EngineerBetter)

						    ```
						    $ AWS_ACCESS_KEY_ID=<access-key-id> \
						         AWS_SECRET_ACCESS_KEY=<secret-access-key> \
						         control-tower deploy --iaas aws <your-project-name>
							```

					</script>
				</section>
				
                <section data-markdown id="architecture">
                    <script type="text/template">
                        <h1 style="font-size: 600%">Concourse Architecture</h1>
                    </script>
                </section>

                <section data-markdown>
                	<script type="text/template">
                        ## Concourse Architecture
                        * Concourse web
                        * Database
                        * Concourse Worker
                        * `fly` CLI
                        * <https://docs.pivotal.io/p-concourse/4-x/architecture.html>
                	</script>
                </section>

                <section>
					<img src="images/architecture-overview.png" style="border: none; box-shadow: none">
				</section>

				<section data-markdown>
                	<script type="text/template">
                        ## Some more details...
                        * EVERYTHING runs in ~~Docker~~ containers
                          * resources as well as jobs
                        * Declarative (YAML) Pipelines
                        * Stateless build jobs
                          * no passing of artifacts inbetween jobs
                        * Connects to external systems instead of re-inventing them
                          * e.g. Vault (credentials management), LDAP (user management)
                        * ~~Plugins~~ Resources (more lightweight)
                        * Highly opinionated (take it or leave it)
                	</script>
                </section>

				<section data-markdown id="blocks">
					<script type="text/template">
						<h1 style="font-size: 600%">Basic Building Blocks</h1>
					</script>
				</section>

                <section data-markdown>
					<script type="text/template">
						## Overview
						<img src="images/building-blocks.png" style="border: none; box-shadow: none">
					</script>
				</section>

				<section data-markdown>
                	<script type="text/template">
						## [Pipeline](https://concourse-ci.org/pipelines.html)
						
						* Glues everything together
						* Mainly configures 2 things:
						  1. set of **resources** (for input and output)
						  1. sequence of **jobs**
                	</script>
                </section>
				
				
				<section data-markdown>
                	<script type="text/template">
						## [Resources](https://concourse-ci.org/included-resources.html)
						
						* manage artifacts used in the pipeline (*inputs/outputs*)
						* can be **checked** (for changes), **pulled** from and **pushed** to
						  * e.g. git, docker, artifactory, s3
						* *"connects Concourse to the outside world"*
						<img src="images/resource.png" style="border: none; box-shadow: none">
                	</script>
                </section>

				<section data-markdown>
					<script type="text/template">
						## [Jobs](https://concourse-ci.org/jobs.html)

						* determine the action(s) of your pipeline
						* plan, which resource, which task, and in which order
						* **you cannot pass artifacts between jobs**
						<img src="images/job.png" width="80%" height="80%" style="border: none; box-shadow: none">
					</script>
				</section>
				

				<section data-markdown>
					<script type="text/template">
						## [Tasks](https://concourse-ci.org/tasks.html)

						* smallest configurable unit in a Concourse pipeline
						* function from inputs to outputs <img src="images/task.png" width="60%" height="60%" style="border: none; box-shadow: none">
						* can either succeed or fail
						* are combined to form a job in your pipeline
						* can be externalized into `task.yml` files 
						  * allows re-use
						  * facilitates debugging
					
					</script>
				</section>


<section data-markdown id="demo">
	<script type="text/template">
		<h1 style="font-size: 800%">Demo Time</h1>
		üîó <a href="https://github.com/michaellihs/concourse-demo">github.com/michaellihs/concourse-demo</a>
	</script>
</section>

<section data-markdown>
<script type="text/template">
## Tutorial 1 - Concourse Setup

* clone [demo repository](https://github.com/michaellihs/concourse-demo) and start Concourse with

	```bash
	git clone git@github.com:michaellihs/concourse-demo.git
	cd concourse-demo
	docker-compose up -d
	```

* download `fly` CLI to `/usr/local/bin/fly`

	```bash
	export concourse_fqdn=localhost
	curl --noproxy ${concourse_fqdn} -s -f -o /usr/local/bin/fly \
		"http://${concourse_fqdn}:8080/api/v1/cli?arch=amd64&platform=darwin"
	chmod u+x /usr/local/bin/fly
	```

* login to Concourse via

	```bash
	fly --target=demo login \
		--concourse-url="http://${concourse_fqdn}:8080" \
		--username=test --password=test --team-name=main
	```

</script>
</section>

<section>
	<h2>Tutorial 2 - Your first Pipeline</h2>

first pipeline with a single job with a single task

<pre><code data-line-numbers="4,8-11">---
jobs:
 - name: hello-world
   plan:
	 - task: hello-world
	   config:
		 platform: linux
		 image_resource:
		   type: docker-image
		   source: {repository: busybox}
		 run:
		   path: echo
		   args:
			 - hello world
</code></pre>
</section>

<section data-markdown>
<script type="text/template">
## Tutorial 2 - Upload your first Pipeline

* upload pipeline via `fly`'s `set-pipeline` command

   ```bash
   cd tutorial-2
   fly --target=demo set-pipeline \
	   --non-interactive \
	   --pipeline=tutorial-2 \
	   --config=pipeline.yml
   ```

* afterwards we *unpause* the pipeline via

   ```bash
   fly --target=demo unpause-pipeline -p tutorial-2
   ```

* login to the Concourse UI and you will see a first pipeline <br>[http://localhost:8080/teams/main/pipelines/tutorial-2](http://localhost:8080/teams/main/pipelines/tutorial-2)

</script>
</section>

<section data-markdown>
<script type="text/template">
## Tutorial 3 - Input and Tasks Files

add `resources` and use `task` from a file

```yaml
---
resources:
- name: demo-repo
  type: git
  source:
    uri: https://github.com/michaellihs/concourse-demo.git
    branch: master

jobs:
- name: hello-world
  plan:
  - get: demo-repo
  - task: hello-world
    file: demo-repo/tutorial-3/hello-world.yml
```
</script>
</section>



                <section data-markdown>
                    <script type="text/template">
                        <h1 style="font-size: 600%">Advanced Concepts</h1>
                    </script>
                </section>

				<section data-markdown>
						<script type="text/template">
							## Credentials Management with Vault
	
							* configure Concourse to use Vault

							   ```bash
							   CONCOURSE_VAULT_URL: https://vault:8200
							   CONCOURSE_VAULT_AUTH_BACKEND: cert
							   CONCOURSE_VAULT_CA_CERT: /vault-certs/vault-ca.crt
							   CONCOURSE_VAULT_CLIENT_CERT: /vault-certs/concourse.crt
							   CONCOURSE_VAULT_CLIENT_KEY: /vault-certs/concourse.key
							   ```

							* use `((pam_var))` placeholders in your pipelines
							* Concourse replaces variables **at runtime**
							* for configuration details see [Concourse Documentation on using Vault](https://concourse-ci.org/vault-credential-manager.html)
						</script>
				</section>

				<section data-markdown>
						<script type="text/template">
							## Re-Usable Tasks
							* Load Tasks from Git repository
							* Share across piplines / projects


							```
							---
							resources:
							  - name: concourse-tasks
							    type: git
							    source:
							      uri: https://github.com/michaellihs/concourse-tasks.git
							  - name: busy-box
							    type: docker-image
							    source: {repository: busybox}

							jobs:
							  - name: job-1
							    plan:
							      - get: demo-repo
							      # TODO check whether we need concourse-tasks
							      - get: busy-box
							      - task: task-1
							        image: busy-box
							        file: concourse-tasks/reused-task.yml
							```
						</script>
				</section>

				<section data-markdown>
						<script type="text/template">
							## The `meta` Pipeline

							* *"Pipeline of Pipelines"* 
							* Re-pipe the world in only a few seconds
							* Scan your Git[Lab|Hub] server and create all the pipelines
						</script>
				</section>

				<section data-markdown>
						<script type="text/template">
							## Custom Resources

							* Docker Image with 3 (shell) scripts
							  1. `check` check for new versions
							  2. `in` pull new versions
							  3. `out` put new versions
							* e.g. Notification resource that sends messages to Threema
							* see [Implementing Custom Resource Types](https://concourse-ci.org/implementing-resource-types.html)
						</script>
				</section>

                <section data-markdown id="recap">
                    <script type="text/template">
                        <h1 style="font-size: 800%">Recap ‚ôªÔ∏è</h1>
                    </script>
				</section>

				<section data-markdown>
					<script type="text/template">
						# The good

						<ul style="list-style: none; font-size: 120%">
						<span class="fragment" data-fragment-index="1"><li>üòÄ pipelines as code</li></span>
						<span class="fragment" data-fragment-index="2"><li>üòÄ pipelines as 1st class citizens</li></span>
						<span class="fragment" data-fragment-index="3"><li>üòÄ containerized builds</li></span>
						<span class="fragment" data-fragment-index="4"><li>üòÄ all resources are versioned, pinning</li></span>
						<span class="fragment" data-fragment-index="5"><li>üòÄ adding workers easily</li></span>
						<span class="fragment" data-fragment-index="6"><li>üòÄ configuration as code</li></span>
						</ul>

					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						# The not so good

						<ul style="list-style: none; font-size: 120%">
							<span class="fragment" data-fragment-index="1"><li>ü§î pipeline debugging</li></span>
							<span class="fragment" data-fragment-index="2"><li>ü§î declarative pipelines</li></span>
							<span class="fragment" data-fragment-index="3"><li>ü§î highly opinionated</li></span>
							<span class="fragment" data-fragment-index="4"><li>ü§î small community</li></span>
						</ul>

					</script>
				</section>


				<section data-markdown>
					<script type="text/template">
						<h1 style="font-size: 800%">üë£ Your <br>Next Steps</h1>
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						## Wanna Learn Concourse Now?

						* [The Concourse Tutorial by Stark & Wayne](https://concoursetutorial.com/)  is a good starting point
						* Dig into [more advanced Concourse Examples](https://github.com/pivotalservices/concourse-pipeline-samples)
						* Become cloudy with the [Spring Cloud Pipelines](https://cloudpipelines.github.io/concourse/) for Concourse
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						<h1 style="font-size: 600%">Thank You ü§ù</h1>
						# <a href="https://twitter.com/kaktusmimi">@kaktusmimi</a>
					</script>
				</section>


				<section data-markdown>
					<script type="text/template">
						<h1 style="font-size: 600%">Questions üôã</h1>
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						## References

						* [Official Concourse Website](https://concourse-ci.org)
						* [Concourse Documentation](https://concourse-ci.org/docs.html)
						* [üëçüëçüëç Concourse Tutorial by Stark & Wayne](https://concoursetutorial.com/)
						* [Concourse Pipeline Samples](https://github.com/pivotalservices/concourse-pipeline-samples/)
						* [Concourse PROs and CONs on Reddit](https://www.reddit.com/r/devops/comments/8ut9tl/concourse_ci_pros_and_cons/)
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						## References

						* [Demo Repository for this Presentation](https://github.com/michaellihs/concourse-demo)
						* [Continous Delivery mit Concourse CI (Andreas Falk)](https://andifalk.github.io/concourse-ci-demo/presentation/index.html)
						* [üëçüëçüëç Build Pipelines that don't suck](https://github.com/sirech/talks/blob/master/2019-04-tw-build_pipelines.pdf)
						* [Concourse Vault Integration](https://concourse-ci.org/vault-credential-manager.html)
						* [Getting started with Concourse CI on Mac](https://medium.com/concourse-ci/getting-started-with-concourse-ci-on-macos-fb3a49a8e6b4)
						* [ThoughtWorks on the "Go Script"](https://www.thoughtworks.com/insights/blog/praise-go-script-part-i)
						* [GoCD: What does piplines as code really mean?](https://www.gocd.org/2017/05/02/what-does-pipelines-as-code-really-mean)
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						## References

						* [HashiCorp Vault](https://www.vaultproject.io/)
						* [BUCC](https://github.com/starkandwayne/bucc)
						* [Control Tower](https://github.com/EngineerBetter/control-tower)
						* [jsonnet](https://jsonnet.org/)
						* [Spruce](https://github.com/geofffranks/spruce)
					</script>
				</section>

			</div>
		</div>

		<script src="js/jquery.js"></script>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});

			var header = $('#header').html();
		    if ( window.location.search.match( /print-pdf/gi ) ) {
		        Reveal.addEventListener( 'ready', function( event ) {
		            $('.slide-background').append(header);
		        });
		    }
		    else {
		        $('div.reveal').append(header);
		   }
		</script>
	</body>
</html>
